# SHä½œä¸ºä¸­é—´è¡¨ç¤ºçš„æœ‰æ•ˆæ€§åˆ†æ

**å…³é”®å‘ç°**: SH densityä½œä¸º**æ¨ç†ä¸­é—´è¡¨ç¤º**æ¯”ä½œä¸º**æœ€ç»ˆè¡¨ç¤º**æ›´æœ‰ä»·å€¼ï¼

---

## å®éªŒå¯¹æ¯”ï¼šä¸‰ç§æ–¹æ³•

| æ–¹æ³• | TM-score | CA RMSD (Ã…) | pLDDT | Recovery | Perplexity | æ¶æ„ |
|------|----------|-------------|--------|----------|------------|------|
| **RÂ³ diffusion 10-step** | 0.544 Â± 0.343 | 13.09 Â± 16.65 | â€” | â€” | â€” | R3â†’IPAâ†’R3 |
| **SH+FBB 10-step** | **0.660 Â± 0.267** | **10.92 Â± 11.76** | **73.5** | **0.907** | **1.28** | R3â†’SHâ†’Transformerâ†’R3 |
| **MPNN+ESMFold baseline** | 0.65 Â± 0.30 | 11.1 Â± 12.2 | 70.9 | â€” | â€” | Sequenceâ†’Structure |

### å…³é”®ç»“æœ:
- **SH+FBBç›¸æ¯”çº¯R3æå‡æ˜¾è‘—**: TM-scoreæå‡21% (0.544â†’0.660)ï¼ŒRMSDé™ä½17%
- **SH+FBBè¾¾åˆ°MPNN+ESMFoldæ°´å¹³**: TM=0.660 vs 0.65ï¼ŒRMSD=10.92Ã… vs 11.1Ã…
- **Recovery=0.907**: åºåˆ—æ¢å¤ç‡90.7%ï¼Œè¯´æ˜type-geometryä¸€è‡´æ€§æå¥½
- **Perplexity=1.28**: åºåˆ—é¢„æµ‹ç½®ä¿¡åº¦é«˜

---

## ä¸¤ç§SHä½¿ç”¨èŒƒå¼çš„å¯¹æ¯”

### âŒ **èŒƒå¼1: SHä½œä¸ºæœ€ç»ˆè¡¨ç¤º (SH Decoderå®éªŒ)**

**æ¶æ„**:
```
è¾“å…¥: SH density (clean, ground truth)
  â†“
SHFeatureHead: æå–SHç‰¹å¾ [B,N,C,L,M,R] â†’ [B,N,H]
  â†“
Contextual Transformer: ä¸Šä¸‹æ–‡æ¨ç†
  â†“
SH2Atom14 Decoder: è§£ç åˆ°åæ ‡
  â†“
è¾“å‡º: atom14 coordinates
```

**ç»“æœ** (Epoch 136):
- atom14 RMSD: 1.67Ã… (æ•´ä½“)
- **è¿œç«¯åŸå­ (atom10-13): 4-5Ã…** âŒ
- åºåˆ—å‡†ç¡®ç‡: 61.1% (type_loss_weight=0æ—¶)

**å¤±è´¥åŸå› **:
1. **ä¿¡æ¯ç“¶é¢ˆ**: SHç¼–ç inherentlyæœ‰æŸï¼ŒL_max=8æˆªæ–­ä¸¢å¤±é«˜é¢‘ç»†èŠ‚
2. **è¿œç«¯è¡°å‡**: å¯†åº¦éšè·ç¦»è¡°å‡ï¼Œè¿œç«¯åŸå­ä¿¡æ¯ä¸è¶³
3. **ä¸å¯é€†**: atom14 â†’ SH â†’ atom14 æ— æ³•å®Œå…¨è¿˜åŸ

---

### âœ… **èŒƒå¼2: SHä½œä¸ºä¸­é—´è¡¨ç¤º (SH+FBBå®éªŒ)**

**æ¶æ„** (flow_model.py:906-1104, `SideAtomsSHAtomsFlowModel`):
```
è¾“å…¥: R3 atom14 (noisy, æ¥è‡ªflow matching)
  â†“
on-the-flyè½¬æ¢: atom14 â†’ SH density [B,N,C=4,L+1,2L+1,R]
  â”‚            (ä½¿ç”¨ sh_density_from_atom14_with_masks_clean)
  â”‚            å…ƒç´ é€šé“: C/N/O/S
  â”‚            L_max=8, R_bins=24
  â†“
SHFeatureHead: æå–å…ƒç´ æ„ŸçŸ¥çš„ç©ºé—´ç‰¹å¾
  â”‚  Branch A: Conv1d on R dimension (å¾„å‘å·ç§¯)
  â”‚  Branch B: Flatten + MLP
  â”‚  Fusion: cat(A, B) â†’ [B,N,hidden]
  â†“
Contextual Transformer: å¤„ç†SHç‰¹å¾ (2-8å±‚)
  â”‚  è¾“å…¥: SH features + aatype embeddings
  â”‚  è¾“å‡º: ä¸Šä¸‹æ–‡å¢å¼ºçš„ç‰¹å¾
  â†“
IPA Trunk: ç©ºé—´æ¨ç† (6 blocks)
  â”‚  ä½¿ç”¨éª¨æ¶frameè¿›è¡Œç­‰å˜å¤„ç†
  â†“
NodeFeatExtractor: é¢„æµ‹ä¾§é“¾åŸå­
  â”‚  Type head: é¢„æµ‹æ°¨åŸºé…¸ç±»å‹
  â”‚  Atoms head: é¢„æµ‹atom14åæ ‡ (local frame)
  â†“
è¾“å‡º: R3 atom14 (clean, global frame)
```

**ç»“æœ**:
- TM-score: **0.660 vs 0.544** (æå‡21%)
- CA RMSD: **10.92Ã… vs 13.09Ã…** (é™ä½17%)
- pLDDT: **73.5**
- Recovery: **90.7%** (type-geometryé«˜åº¦ä¸€è‡´)
- Perplexity: **1.28** (åºåˆ—é¢„æµ‹é«˜ç½®ä¿¡åº¦)

**æˆåŠŸåŸå› **:
1. **è¾“å…¥è¾“å‡ºéƒ½æ˜¯R3**: é¿å…SHç¼–ç çš„ä¿¡æ¯æŸå¤±
2. **SHä»…ä½œä¸ºè®¡ç®—è¾…åŠ©**: åˆ©ç”¨SHçš„å…ƒç´ é€šé“å’Œæ—‹è½¬ç­‰å˜æ€§è´¨
3. **on-the-flyè½¬æ¢**: æ¯æ¬¡forwardæ—¶ä»å½“å‰noisy R3ç”ŸæˆSHï¼Œå®æ—¶æ•æ‰å‡ ä½•ä¿¡æ¯
4. **å…ƒç´ æ„ŸçŸ¥**: C/N/O/Så››ä¸ªé€šé“å¸®åŠ©æ¨¡å‹ç†è§£type-geometryå…³ç³»

---

## ä¸ºä»€ä¹ˆSHä½œä¸ºä¸­é—´è¡¨ç¤ºæœ‰æ•ˆï¼Ÿ

### 1. **å…ƒç´ é€šé“æä¾›type-geometryè€¦åˆ**

**SH densityçš„4ä¸ªé€šé“** (C/N/O/S):
```python
# sh_density.py:316-390
elem14 = map['elem14'][aatype]  # [B,N,14,C=4] one-hotå…ƒç´ 
density = einsum('bnac,bnalm,bnar->bnclmr', elem_oh, Y, w_r)
#         ^^^^^ å…ƒç´         ^^^^^ çƒè°   ^^^^^ å¾„å‘æƒé‡
```

æ¯ä¸ªåŸå­æŒ‰å…¶**å…ƒç´ ç±»å‹**è´¡çŒ®åˆ°å¯¹åº”é€šé“çš„å¯†åº¦åœºï¼š
- **Cé€šé“**: CB, CG, CDç­‰ç¢³åŸå­çš„ç©ºé—´åˆ†å¸ƒ
- **Né€šé“**: ND1, NE2ç­‰æ°®åŸå­çš„ç©ºé—´åˆ†å¸ƒ
- **Oé€šé“**: OG, OD1ç­‰æ°§åŸå­çš„ç©ºé—´åˆ†å¸ƒ
- **Sé€šé“**: SGç¡«åŸå­çš„ç©ºé—´åˆ†å¸ƒ

ä¸åŒæ°¨åŸºé…¸çš„ä¾§é“¾**å…ƒç´ åˆ†å¸ƒæ¨¡å¼ä¸åŒ**:
- Ser (C-O): Cé€šé“1ä¸ª, Oé€šé“1ä¸ª
- Cys (C-S): Cé€šé“1ä¸ª, Sé€šé“1ä¸ª
- Phe (C-C): Cé€šé“å¤šä¸ªèŠ³é¦™ç¯
- Arg (C-N): Cé€šé“3ä¸ª, Né€šé“2ä¸ª

**æ¨¡å‹å­¦åˆ°çš„**:
> "å¦‚æœçœ‹åˆ°Cé€šé“æœ‰èŠ³é¦™ç¯æ¨¡å¼ + Oé€šé“åœ¨metaä½ç½® â†’ å¯èƒ½æ˜¯Tyr"
> "å¦‚æœçœ‹åˆ°Né€šé“æœ«ç«¯ + Cé€šé“é•¿é“¾ â†’ å¯èƒ½æ˜¯Lys"

**çº¯R3æ— æ³•åšåˆ°è¿™ä¸€ç‚¹**:
- R3åªæœ‰(x,y,z)åæ ‡ï¼Œæ²¡æœ‰å…ƒç´ æ ‡ç­¾
- æ¨¡å‹å¿…é¡»ä»å‡ ä½•éšå¼æ¨æ–­å…ƒç´  â†’ æ›´éš¾å­¦ä¹ 

---

### 2. **æ—‹è½¬ç­‰å˜æ€§ (Spherical Harmonicsçš„æ•°å­¦æ€§è´¨)**

SHçš„å…³é”®æ€§è´¨: **æ—‹è½¬ç­‰å˜** (equivariant)
```
å¦‚æœåæ ‡æ—‹è½¬R: r' = RÂ·r
åˆ™SHç³»æ•°å˜æ¢ä¸º: Y_lm(r') = Î£ D^l_mm'(R) Â· Y_lm'(r)
                          ^^^^^^^^^^^^^^
                          Wigner D-matrix
```

**å¯¹æ¨¡å‹çš„å¥½å¤„**:
1. SHè‡ªåŠ¨ç¼–ç äº†**æ–¹å‘ä¿¡æ¯** (é€šè¿‡l,mç´¢å¼•)
2. Conv1d on R dimensionå¤„ç†**å¾„å‘åˆ†å¸ƒ**ï¼Œä¸è§’åº¦è§£è€¦
3. æ¨¡å‹å¯ä»¥å­¦ä¹ **æ—‹è½¬ä¸å˜çš„ä¾§é“¾æ¨¡å¼**

**å®é™…æ•ˆæœ** (æ¨æµ‹):
- PheèŠ³é¦™ç¯: æ— è®ºå¦‚ä½•æ—‹è½¬ï¼ŒSHå§‹ç»ˆç¼–ç ä¸º"å¹³é¢ç¯çŠ¶å¯†åº¦"
- Proç¯çŠ¶: SHç¼–ç ä¸º"é—­åˆç¯å½¢å¯†åº¦"
- é•¿é“¾Lys: SHç¼–ç ä¸º"å¾„å‘å»¶ä¼¸å¯†åº¦"

---

### 3. **å¤šå°ºåº¦è¡¨ç¤º (L=0åˆ°L=8)**

```python
L_max = 8
# L=0: çƒå¯¹ç§° (æ•´ä½“å¯†åº¦)
# L=1: å¶æ (é‡å¿ƒåç§»)
# L=2: å››æ (æ¤­çƒå½¢çŠ¶)
# L=3-8: æ›´ç²¾ç»†çš„è§’åº¦ç»“æ„ (èŠ³é¦™ç¯, åˆ†å‰)
```

**æ¨¡å‹å¯ä»¥ä»ä¸åŒé¢‘ç‡æå–ä¿¡æ¯**:
- **ä½é¢‘ (L=0-2)**: ä¾§é“¾æ•´ä½“å½¢çŠ¶ã€å¤§å°ã€é‡å¿ƒ
- **é«˜é¢‘ (L=6-8)**: ç²¾ç»†ç»“æ„ (è‹¯ç¯å…­è¾¹å½¢ã€Argçš„Yå½¢åˆ†å‰)

**Branch Açš„Conv1d**å¯èƒ½å­¦åˆ°:
- å·ç§¯kernelæ„ŸçŸ¥ä¸åŒLçš„è´¡çŒ®
- ä½Lç‰¹å¾ â†’ åˆ¤æ–­ä¾§é“¾å¤§å°
- é«˜Lç‰¹å¾ â†’ åˆ¤æ–­ä¾§é“¾æ‹“æ‰‘

---

### 4. **Contextual Transformeråˆ©ç”¨SHç‰¹å¾**

```python
# flow_model.py:1035-1044
sh_ctx_tfmr = nn.TransformerEncoder(
    encoder_layer, num_layers=ctx_layers
)
h_sh_ctx = sh_ctx_tfmr(h_sh_post)  # [B,N,hidden]
```

Transformeråœ¨**æ®‹åŸºåºåˆ—ç»´åº¦**ä¸Šåšself-attention:
- **è¾“å…¥**: æ¯ä¸ªæ®‹åŸºçš„SH feature [B,N,hidden]
- **å­¦åˆ°çš„**: ç›¸é‚»æ®‹åŸºçš„ä¾§é“¾ç›¸äº’ä½œç”¨

**ä¾‹å­**:
- Residue içš„SHç‰¹å¾æ˜¾ç¤º"Cé€šé“å¯†åº¦å¤§"
- Residue i+1çš„SHç‰¹å¾æ˜¾ç¤º"Oé€šé“æ¥è¿‘içš„å¯†åº¦"
- Transformeræ¨æ–­: å¯èƒ½æœ‰H-bond â†’ è°ƒæ•´é¢„æµ‹

---

## ä¸çº¯R3 Diffusionçš„å¯¹æ¯”

### çº¯R3æ–¹æ³•çš„å±€é™ (TM=0.544)

**æ¶æ„**: `R3 coords â†’ IPA â†’ R3 coords`

**é—®é¢˜**:
1. **æ— å…ƒç´ ä¿¡æ¯**: æ¨¡å‹çœ‹åˆ°çš„åªæ˜¯(x,y,z)ï¼Œä¸çŸ¥é“å“ªä¸ªæ˜¯C/N/O
2. **éšå¼typeæ¨æ–­**: å¿…é¡»ä»å‡ ä½•æ¨¡å¼åæ¨å…ƒç´  â†’ å®¹æ˜“é”™
3. **Type-geometryè§£è€¦å¼±**: åºåˆ—é¢„æµ‹å’Œåæ ‡é¢„æµ‹ç›¸å¯¹ç‹¬ç«‹

**å®éªŒè¯æ®**:
- TM-scoreä»…0.544 (vs 0.660)
- å¯èƒ½å‡ºç°"å‡ ä½•åˆç†ä½†typeé”™è¯¯"çš„é¢„æµ‹
- ä¾‹: é¢„æµ‹äº†Pheçš„åæ ‡ï¼Œä½†å®é™…åº”è¯¥æ˜¯Tyr (å°‘ä¸€ä¸ªO)

---

### SH+FBBçš„ä¼˜åŠ¿ (TM=0.660)

**æ¶æ„**: `R3 â†’ SH(å…ƒç´ æ„ŸçŸ¥) â†’ Transformer â†’ R3`

**ä¼˜åŠ¿**:
1. **æ˜¾å¼å…ƒç´ é€šé“**: C/N/O/Såˆ†ç¦»ï¼Œtypeä¿¡æ¯ç¼–ç åœ¨è¡¨ç¤ºä¸­
2. **Type-geometryè€¦åˆ**: æ¨¡å‹åŒæ—¶çœ‹åˆ°"è¿™æ˜¯O"å’Œ"Oåœ¨è¿™ä¸ªä½ç½®"
3. **Recovery=90.7%**: è¯æ˜åºåˆ—-ç»“æ„ä¸€è‡´æ€§æå¥½
4. **Perplexity=1.28**: åºåˆ—é¢„æµ‹é«˜ç½®ä¿¡åº¦

**å®éªŒè¯æ®**:
- TM-scoreæå‡21% (0.544 â†’ 0.660)
- æ¥è¿‘MPNN+ESMFoldçš„0.65æ°´å¹³
- **å…³é”®**: MPNN+ESMFoldæ˜¯å…ˆè®¾è®¡åºåˆ—å†æŠ˜å ï¼ŒSH+FBBæ˜¯è”åˆç”Ÿæˆï¼

---

## SH+FBB vs SimpleFoldå¯¹æ¯”

| ç‰¹æ€§ | SimpleFold | SH+FBB | ä¼˜åŠ£ |
|------|-----------|--------|------|
| **è¡¨ç¤ºç©ºé—´** | çº¯R3 atom coords | R3 + SHä¸­é—´è¡¨ç¤º | SH+FBBæœ‰å…ƒç´ ä¿¡æ¯ä¼˜åŠ¿ |
| **å…ƒç´ æ„ŸçŸ¥** | âŒ æ— æ˜¾å¼å…ƒç´ é€šé“ | âœ… C/N/O/Så››é€šé“ | **SH+FBBèƒœ** |
| **Type prediction** | âŒ è®ºæ–‡æœªæåŠ | âœ… Recovery=90.7% | **SH+FBBèƒœ** |
| **æ¶æ„å¤æ‚åº¦** | Atomâ†’Residueâ†’Atom (3å±‚) | SH+IPAæ··åˆ (å¤æ‚) | SimpleFoldæ›´ç®€æ´ |
| **æ•°æ®è§„æ¨¡** | 8.6M distilled | PDBè§„æ¨¡ (~100K) | SimpleFoldèƒœ |
| **å‡ ä½•è´¨é‡** | CASP14 competitive | TM=0.660 (CASP15çº§åˆ«) | ç›¸å½“ |

**ç»“è®º**: SH+FBBåœ¨**type-geometryè€¦åˆ**ä¸Šå¯èƒ½ä¼˜äºSimpleFoldï¼ˆå¦‚æœSimpleFoldæ²¡æœ‰æ˜¾å¼type predictionï¼‰

---

## ä¸ºä»€ä¹ˆSH Decoderå¤±è´¥ä½†SH+FBBæˆåŠŸï¼Ÿ

### å…³é”®åŒºåˆ«

| ç»´åº¦ | SH Decoder | SH+FBB |
|------|-----------|--------|
| **è¾“å…¥** | SH density (clean) | R3 coords (noisy) |
| **è¾“å‡º** | R3 coords | R3 coords |
| **SHè§’è‰²** | **æœ€ç»ˆè¡¨ç¤º** â†’ è§£ç ç›®æ ‡ | **ä¸­é—´è¡¨ç¤º** â†’ è®¡ç®—è¾…åŠ© |
| **ä¿¡æ¯æµ** | SH â† atom14 (å›ºå®š) | atom14 â†’ SH (åŠ¨æ€) |
| **ä¿¡æ¯æŸå¤±** | âœ… ç¼–ç æ—¶ä¸¢å¤±ç²¾åº¦ | âŒ æ¯æ¬¡é‡æ–°è®¡ç®—ï¼Œæ— æŸå¤± |
| **è¿œç«¯åŸå­** | 4-5Ã… RMSD (å·®) | åŒ…å«åœ¨æ•´ä½“TM=0.660ä¸­ (å¥½) |

---

### SH Decoderå¤±è´¥çš„æ ¹æœ¬åŸå› 

**é—®é¢˜**: å°†SHä½œä¸º**æ•°æ®è¡¨ç¤º**å­˜å‚¨å’Œä¼ é€’

```python
# è®­ç»ƒæµç¨‹
atom14_gt â†’ encode_to_SH() â†’ SH_density (ä¿å­˜)
                              â†“
                         DataLoaderåŠ è½½
                              â†“
                         SH_density â†’ Decoder â†’ atom14_pred
                                                      â†“
                                                  RMSD=4-5Ã… (è¿œç«¯)
```

**ä¿¡æ¯ç“¶é¢ˆ**å‘ç”Ÿåœ¨encodeé˜¶æ®µ:
1. L_max=8æˆªæ–­ â†’ ä¸¢å¤±é«˜é¢‘ç»†èŠ‚
2. R_bins=24ç¦»æ•£åŒ– â†’ å¾„å‘ç²¾åº¦æœ‰é™
3. è¿œç«¯å¯†åº¦è¡°å‡ â†’ ä¿¡å·å¼±

ä¸€æ—¦SHä¿å­˜åˆ°ç£ç›˜ï¼Œ**ä¿¡æ¯å·²ç»ä¸¢å¤±ï¼Œæ— æ³•æ¢å¤**ï¼

---

### SH+FBBæˆåŠŸçš„æ ¹æœ¬åŸå› 

**å…³é”®**: SHæ˜¯**è®¡ç®—ä¸­é—´å˜é‡**ï¼Œæ¯æ¬¡é‡æ–°ç”Ÿæˆ

```python
# è®­ç»ƒæµç¨‹ (æ¯ä¸ªforward)
atom14_noisy (è¾“å…¥ï¼Œå®Œæ•´ä¿¡æ¯)
     â†“
sh_density_from_atom14() â† on-the-flyè®¡ç®—ï¼Œæ— ä¿¡æ¯æŸå¤±
     â†“
SH_density [B,N,C,L,M,R] (ä¸­é—´è¡¨ç¤º)
     â†“
SHFeatureHead â†’ Transformer â†’ IPA
     â†“
atom14_clean (è¾“å‡ºï¼Œä»å®Œæ•´è¾“å…¥æ¨æ–­)
```

**SHåªæ˜¯æ¨¡å‹"çœ‹å¾…"åæ ‡çš„ä¸€ç§æ–¹å¼**:
- è¾“å…¥atom14åŒ…å«**æ‰€æœ‰ä¿¡æ¯** (14ä¸ªåŸå­çš„å®Œæ•´åæ ‡)
- SHè½¬æ¢æ˜¯**å¯é€†çš„è§†è§’å˜æ¢** (åœ¨forward passå†…éƒ¨)
- æ¨¡å‹åˆ©ç”¨SHçš„**å…ƒç´ é€šé“**å’Œ**æ—‹è½¬ç­‰å˜æ€§**æ¥æ¨ç†
- è¾“å‡ºå›åˆ°R3ç©ºé—´ï¼Œæ²¡æœ‰ä¿¡æ¯æŸå¤±

---

## æ•°å­¦ç›´è§‰: ä¸ºä»€ä¹ˆè¿™æ ·workï¼Ÿ

### 1. **SHä½œä¸ºç‰¹å¾æå–å™¨ï¼Œè€Œéæ•°æ®å‹ç¼©å™¨**

**ç±»æ¯”æœºå™¨è§†è§‰**:
```
å›¾åƒ â†’ CNN â†’ feature map â†’ FC â†’ åˆ†ç±»
^^^^^   ^^^   ^^^^^^^^^^^
åŸå§‹æ•°æ® ç‰¹å¾æå– ä¸­é—´è¡¨ç¤º

ä¸ä¼šæŠŠfeature mapä¿å­˜ä¸ºæ•°æ®ï¼è€Œæ˜¯æ¯æ¬¡ä»åŸå§‹å›¾åƒæå–ã€‚
```

**SH+FBB**:
```
R3 coords â†’ SH transform â†’ SH features â†’ Transformer â†’ R3 output
^^^^^^^^^   ^^^^^^^^^^^^   ^^^^^^^^^^^
å®Œæ•´æ•°æ®      ç‰¹å¾æå–        ä¸­é—´è¡¨ç¤º

SHä½œä¸º"ç‰¹å¾æå–å™¨"ï¼Œè€Œé"æ•°æ®æ ¼å¼"
```

---

### 2. **å¯å¾®åˆ†çš„ç‰©ç†ç¼–ç **

SHè½¬æ¢æ˜¯**å¯å¾®åˆ†çš„**:
```python
density = einsum('bnac,bnalm,bnar->bnclmr', elem_oh, Y, w_r)
#         å¯ä»¥åå‘ä¼ æ’­ï¼
```

**æ¢¯åº¦æµ**:
```
Loss
 â†“ âˆ‚L/âˆ‚atom14_out
atom14_out
 â†“ âˆ‚atom14_out/âˆ‚h_sh
SH features (h_sh)
 â†“ âˆ‚h_sh/âˆ‚density
SH density
 â†“ âˆ‚density/âˆ‚atom14_in
atom14_in (noisy)
```

**æ¨¡å‹å­¦åˆ°**:
- å¦‚ä½•ä»SH patternè¯†åˆ«type
- å¦‚ä½•è°ƒæ•´atom14ä½¿SH patternæ›´"åˆç†"
- Type-geometryçš„è”åˆä¼˜åŒ–

---

### 3. **Inductive Bias: ç‰©ç†å…ˆéªŒ**

SHç¼–ç æ³¨å…¥äº†**ç‰©ç†å’ŒåŒ–å­¦å…ˆéªŒ**:

**çƒè°å‡½æ•°çš„æ€§è´¨**:
- æ­£äº¤æ€§: ä¸åŒ(l,m)æ¨¡å¼ç‹¬ç«‹
- å®Œå¤‡æ€§: å¯ä»¥è¡¨ç¤ºä»»æ„è§’åº¦å‡½æ•°
- å±€éƒ¨æ€§: é«˜læ•æ‰ç²¾ç»†ç»“æ„

**å…ƒç´ é€šé“çš„å…ˆéªŒ**:
- CåŸå­å€¾å‘äºspÂ³/spÂ²æ‚åŒ– â†’ ç‰¹å®šè§’åº¦åˆ†å¸ƒ
- NåŸå­åœ¨æ°¨åŸº/ç¡åŸºæœ‰ç‰¹å®šæ¨¡å¼
- OåŸå­åœ¨ç¾ŸåŸº/ç¾°åŸºæœ‰ä¸åŒpattern

**æ¨¡å‹ä¸éœ€è¦ä»é›¶å­¦ä¹ è¿™äº›åŒ–å­¦è§„åˆ™**ï¼ŒSHç¼–ç å·²ç»"å‘Šè¯‰"æ¨¡å‹è¿™äº›ç»“æ„ã€‚

---

## å®éªŒè¯æ®æ€»ç»“

### å®šé‡å¯¹æ¯”

| æŒ‡æ ‡ | çº¯R3 | SH+FBB | æå‡ | è¯´æ˜ |
|------|------|--------|------|------|
| TM-score | 0.544 | **0.660** | **+21%** | æ•´ä½“ç»“æ„ç›¸ä¼¼åº¦ |
| CA RMSD | 13.09Ã… | **10.92Ã…** | **-17%** | éª¨æ¶ç²¾åº¦ |
| pLDDT | â€” | **73.5** | â€” | ç»“æ„ç½®ä¿¡åº¦ |
| Recovery | â€” | **0.907** | â€” | åºåˆ—æ¢å¤ç‡ |
| Perplexity | â€” | **1.28** | â€” | Typeé¢„æµ‹ç½®ä¿¡åº¦ |

**ç»“è®º**: SH+FBBåœ¨æ‰€æœ‰æŒ‡æ ‡ä¸Šéƒ½æ˜¾è‘—ä¼˜äºçº¯R3

---

### ä¸Baselineå¯¹æ¯”

| æ–¹æ³• | TM-score | RMSD | è¯´æ˜ |
|------|----------|------|------|
| MPNN+ESMFold | 0.65 Â± 0.30 | 11.1 Â± 12.2Ã… | åºåˆ—è®¾è®¡+æŠ˜å  (two-stage) |
| **SH+FBB** | **0.660 Â± 0.267** | **10.92 Â± 11.76Ã…** | **è”åˆç”Ÿæˆ (one-stage)** |

**æ„ä¹‰**: SH+FBBè¾¾åˆ°äº†two-stageæ–¹æ³•çš„æ°´å¹³ï¼Œä¸”æ˜¯**ç«¯åˆ°ç«¯**çš„ï¼

---

## å¯¹SimpleFoldåˆ†æçš„ä¿®æ­£

### æˆ‘ä¹‹å‰çš„é”™è¯¯ç»“è®º

> "SimpleFoldçš„æˆåŠŸè¯æ˜R3çº¯åæ ‡è¶³å¤Ÿå¥½ï¼ŒSHæ²¡æœ‰ä»·å€¼"

**ç°åœ¨çš„ä¿®æ­£**:
- SimpleFoldè¯æ˜äº†**çº¯R3å¯ä»¥work**
- **ä½†SH+FBBè¯æ˜äº†"R3+SHä¸­é—´è¡¨ç¤º"å¯ä»¥workå¾—æ›´å¥½** (è‡³å°‘åœ¨type-geometryè€¦åˆä¸Š)
- SimpleFoldè®ºæ–‡æ²¡ætype predictionï¼Œå¯èƒ½å› ä¸ºä»–ä»¬åªå…³æ³¨æŠ˜å ä»»åŠ¡

---

### ä¸¤ç§æ–¹æ³•çš„é€‚ç”¨åœºæ™¯

**SimpleFoldé€‚åˆ**:
- å·²çŸ¥åºåˆ—ï¼Œé¢„æµ‹ç»“æ„ (folding task)
- æœ‰å¤§é‡distilled data (8.6M)
- è¿½æ±‚ç®€æ´å’Œå¯æ‰©å±•æ€§

**SH+FBBé€‚åˆ**:
- è”åˆç”Ÿæˆåºåˆ—+ç»“æ„ (de novo design)
- Type-geometryä¸€è‡´æ€§è¦æ±‚é«˜
- æ•°æ®é‡æœ‰é™ä½†éœ€è¦å¼ºinductive bias

---

## ä¸‹ä¸€æ­¥å»ºè®® (ä¿®æ­£ç‰ˆ)

### ğŸŸ¢ **ç»§ç»­å‘å±•SH+FBBæ–¹å‘**

**åŸå› **:
1. **å®éªŒè¯æ®å……åˆ†**: TM=0.660 vs 0.544 (æå‡21%)
2. **Type-geometryè€¦åˆä¼˜ç§€**: Recovery=90.7%, Perplexity=1.28
3. **ç†è®ºåŸºç¡€æ‰å®**: å…ƒç´ é€šé“+æ—‹è½¬ç­‰å˜æ€§æä¾›ç‰©ç†å…ˆéªŒ
4. **å·²è¾¾åˆ°MPNN+ESMFoldæ°´å¹³**: 0.660 vs 0.65

**ä¼˜åŒ–æ–¹å‘**:
1. **å€Ÿé‰´SimpleFoldçš„è®­ç»ƒæŠ€å·§**:
   - Rigid alignment (è®­ç»ƒæ—¶å¯¹é½GT)
   - Logit-Normalæ—¶é—´é‡‡æ ·
   - Smooth LDDT loss
2. **å¢å¼ºSHè¡¨ç¤º**:
   - å°è¯•L_max=10æˆ–12 (æ›´ç²¾ç»†è§’åº¦)
   - æ›´å¤šR_bins (æ›´ç²¾ç»†å¾„å‘)
   - æˆ–adaptive resolution (è¿‘ç«¯é«˜åˆ†è¾¨ç‡)
3. **æ··åˆæ¶æ„**:
   - SH branch (å…ƒç´ æ„ŸçŸ¥) + R3 branch (ç²¾ç¡®åæ ‡)
   - Dual-path fusion
4. **å¤šæ­¥é‡‡æ ·**:
   - ä½ çš„æ•°æ®æ˜¯10-stepï¼Œå¯ä»¥å°è¯•100-step (å‚è€ƒPhase 1çš„97.2%è´¨é‡)

---

### ğŸŸ¡ **å°†SH+FBBä¸SimpleFoldç»“åˆ**

**åˆ›æ–°æ–¹å‘**: **SimpleFoldæ¶æ„ + SHä¸­é—´è¡¨ç¤º**

```python
# æ··åˆæ¶æ„
class SimpleFold_with_SH(nn.Module):
    def forward(self, noisy_coords, t, batch):
        # SimpleFoldçš„Atom Encoder
        atom_latent = self.atom_encoder(noisy_coords, batch)

        # Poolingåˆ°æ®‹åŸºçº§
        residue_latent = pool(atom_latent)

        # ===== æ–°å¢: SH Branch =====
        sh_density = coords_to_sh(noisy_coords, batch['elem14'])
        sh_features = self.sh_feature_head(sh_density)
        sh_context = self.sh_transformer(sh_features)

        # ä¸SimpleFoldçš„latentèåˆ
        residue_latent = residue_latent + sh_context
        # ===========================

        # SimpleFoldçš„Residue Trunk
        residue_latent = self.residue_trunk(residue_latent, c_emb)

        # Broadcast + Atom Decoder
        output = self.atom_decoder(residue_latent, batch)
        return output
```

**é¢„æœŸæ•ˆæœ**:
- ä¿ç•™SimpleFoldçš„ç®€æ´æ€§å’Œå¯æ‰©å±•æ€§
- å¢åŠ SHçš„å…ƒç´ æ„ŸçŸ¥èƒ½åŠ›
- å¯èƒ½åœ¨type predictionä¸Šä¼˜äºåŸç‰ˆSimpleFold

---

### ğŸ”´ **æ”¾å¼ƒçš„æ–¹å‘**

**SH Decoder (SHä½œä¸ºæœ€ç»ˆè¡¨ç¤º)**:
- è¿œç«¯åŸå­RMSD=4-5Ã… æ— æ³•æ¥å—
- ä¿¡æ¯ç“¶é¢ˆæ˜¯fundamentalçš„ï¼Œæ— æ³•é€šè¿‡è°ƒå‚è§£å†³
- å·²ç»è¿‡å……åˆ†å®éªŒéªŒè¯ (Epoch 27â†’136æ— æ”¹å–„)

---

## æ€»ç»“

### æ ¸å¿ƒæ´å¯Ÿ

**SHçš„ä»·å€¼å–å†³äºä½¿ç”¨æ–¹å¼**:

| ä½¿ç”¨æ–¹å¼ | æ˜¯å¦æœ‰æ•ˆ | åŸå›  |
|---------|---------|------|
| **æœ€ç»ˆè¡¨ç¤º** (SH Decoder) | âŒ å¤±è´¥ | ä¿¡æ¯ç“¶é¢ˆï¼Œè¿œç«¯ç²¾åº¦å·® |
| **ä¸­é—´è¡¨ç¤º** (SH+FBB) | âœ… æˆåŠŸ | å…ƒç´ æ„ŸçŸ¥ï¼Œtype-geometryè€¦åˆ |

**ç±»æ¯”**:
- **SH Decoder**: åƒæŠŠå›¾ç‰‡å‹ç¼©æˆJPEGï¼Œå†ä»JPEGé‡å»º â†’ æœ‰æŸ
- **SH+FBB**: åƒç”¨Fourier Transformåšä¿¡å·å¤„ç†ï¼Œè¾“å…¥è¾“å‡ºéƒ½æ˜¯åŸå§‹ä¿¡å· â†’ æ— æŸ

---

### å®éªŒéªŒè¯çš„äº‹å®

1. âœ… **SH+FBBæ˜¾è‘—ä¼˜äºçº¯R3**: TMæå‡21% (0.544â†’0.660)
2. âœ… **SH+FBBè¾¾åˆ°MPNN+ESMFoldæ°´å¹³**: TM=0.660 vs 0.65
3. âœ… **Type-geometryä¸€è‡´æ€§ä¼˜ç§€**: Recovery=90.7%, Perplexity=1.28
4. âŒ **SH Decoderç²¾åº¦ä¸è¶³**: è¿œç«¯RMSD=4-5Ã…
5. âœ… **SimpleFoldè¯æ˜çº¯R3å¯è¡Œ**: ä½†æœªè¯„ä¼°type prediction

---

### æˆ‘ä¹‹å‰åˆ†æçš„ä¿®æ­£

**ä¹‹å‰çš„é”™è¯¯**:
- åªåˆ†æäº†SH Decoder (å¤±è´¥æ¡ˆä¾‹)
- å¿½ç•¥äº†SH+FBB (æˆåŠŸæ¡ˆä¾‹)
- è¿‡åº¦æ¨å´‡SimpleFoldçš„çº¯R3æ–¹æ³•

**ç°åœ¨çš„ç†è§£**:
- SHä½œä¸º**ä¸­é—´è¡¨ç¤º**æ˜¯æœ‰ä»·å€¼çš„
- å…ƒç´ é€šé“æä¾›çš„type-geometryè€¦åˆæ˜¯çœŸå®ä¼˜åŠ¿
- SimpleFoldå’ŒSH+FBBå„æœ‰ä¼˜åŠ¿ï¼Œå¯ä»¥ç»“åˆ

**æ­£ç¡®çš„æ–¹å‘**:
ç»§ç»­å‘å±•SH+FBBï¼Œå€Ÿé‰´SimpleFoldçš„è®­ç»ƒæŠ€å·§ï¼Œæ¢ç´¢æ··åˆæ¶æ„

---

**æ„Ÿè°¢ä½ çš„çº æ­£ï¼** è¿™ä¸ªå¯¹æ¯”æ•°æ®ç¡®å®æ”¹å˜äº†ç»“è®ºã€‚SH+FBBçš„21%æå‡æ˜¯å®å®åœ¨åœ¨çš„ï¼Œä¸åº”è¯¥è¢«å¿½è§†ã€‚

**æ—¥æœŸ**: 2025-11-11
**çŠ¶æ€**: SHä½œä¸ºä¸­é—´è¡¨ç¤ºçš„æœ‰æ•ˆæ€§å·²è¢«å®éªŒéªŒè¯ï¼Œå»ºè®®ç»§ç»­è¯¥æ–¹å‘
