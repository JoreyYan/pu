## 蛋白质生成建模路线对比与统一框架讨论纪要

### 一、问题背景

目标是设计一个既能**生成高亲和力 binder**，又能**统一 DNA / RNA / 蛋白质 / 小分子**的生成框架。关键问题在于：
1. 如何在几何层面实现从 A (受体) 到 B (binder) 的条件生成；
2. 如何在表征层面实现跨模态统一；
3. 如何兼顾高分辨率几何与多模态语义。

---

### 二、核心路线的三种形态

#### 1. 路线①：Flow + SH 扩散（显式几何生成）
- **输入**：A 的几何特征 + SH 密度。
- **输出**：B 的 frame（主链刚体）与 SH（局部密度/化学特征）。
- **建模空间**：R³ / SH 系数空间。
- **优点**：
  - 显式几何一致性，可直接加入能量约束；
  - 物理可解释，能分析生成过程；
  - 适合高亲和 binder 生成（可能量引导）。
- **缺点**：
  - 高维、训练与采样成本大；
  - 不易跨模态扩展（不同模态需各自定义投影）。

> 核心思想：学习 p(B | A) 在几何空间的流动。

#### 2. 路线②：VAE / 自编码器压缩 frame + SH 为 latent，再在 latent 上扩散 / 自回归
- **输入**：A 的几何 + SH → Encoder → z_A。
- **生成**：在 latent 上建模 p(z_B | z_A)，再 Decoder → B 的 frame + SH。
- **建模空间**：低维 latent manifold。
- **优点**：
  - 可统一多模态（DNA/RNA/蛋白/小分子共享 latent）；
  - 扩散/自回归更高效，采样速度快；
  - 适合与语言模型（序列）结合。
- **缺点**：
  - latent 必须学习到几何一致性，否则解码失真；
  - 能量引导与物理解释性较弱。

> 核心思想：让 latent 表达几何与化学语义，在压缩空间完成生成。

#### 3. 路线③：VAE 压缩主链原子 + VAR（多尺度自回归）预测 backbone，再生成 SH
- **流程**：直接在坐标域压缩 backbone → 用 VAR/next-scale autoregressive 生成主链几何 → 补充 SH 细节。
- **特点**：
  - 对齐 2024 NeurIPS Best Paper “VAR” 思路（next-scale prediction）；
  - 多分辨率生成，低频→高频 refinement；
  - 适合结合实验密度（Cryo-EM）。
- **优点**：多尺度物理一致性强；
- **缺点**：训练复杂、损失耦合难。

> 核心思想：多尺度几何 refine，实现从粗骨架到细节密度的生成。

---

### 三、Flow + SH 与 Latent 扩散的本质区别

| 维度 | Flow + SH 扩散 | Latent 扩散 / 自回归 |
|------|----------------|------------------------|
| 数据空间 | 几何 + SH 实空间 | 压缩后的 latent 空间 |
| 可解释性 | 高，直接对应原子几何 | 低，latent 语义隐式 |
| 物理一致性 | 易控制、能量项可加入 | 需额外能量映射 E(z) |
| 跨模态扩展 | 需各模态定义几何映射 | 一次性统一 latent |
| 采样效率 | 慢，高维扩散 | 快，低维扩散 |
| 学习内容 | 物理形变场 f(A→B) | 语义概率映射 p(z_B|z_A) |

> 结论：两者本质上都在逼近 p(B|A)，区别在于工作空间不同。
> - Flow + SH：物理显式生成器（几何层）。
> - Latent 扩散：语义隐式生成器（抽象层）。

---

### 四、统一 backbone 表示：ChemFrame 规范

为实现多模态统一，只需定义通用 backbone：
- **节点（刚体单元 RB）**：蛋白残基主链、核苷糖–磷酸、芳环、小分子刚体基团等；
- **边（键连接）**：可旋转单键，对应扭转角自由度；
- **Frame 构造**：基于三个锚点原子或主惯性轴；
- **局部场表示**：在每个 Frame 下计算 SH 密度/电势等局部通道。

这样，DNA/RNA/蛋白/小分子都可转化为统一的“Frame 图 + SH 场”，无需为模态单独定义表示。

---

### 五、能否直接通过 SH 扩散获得 nM 级 binder？
- 直接扩散 SH 可生成“几何互补”构象（ΔE_geom 低），但不能保证自由能 ΔG 极小；
- 需在采样中加入 **energy-guided term**：\( -\nabla_x E_{bind}(x,A) \)；
- 或在 latent 上加 ΔG ranking / 能量重排序。

> 结论：单纯几何扩散可达 μM 水平；若要 nM binder，必须能量引导或后筛选。

---

### 六、整体路线建议

1. **Phase 1** – 先训练 Flow + SH 扩散：
   - 明确几何与能量一致性，建立高亲和力生成器。
2. **Phase 2** – 收集 frame + SH latent：
   - 训练 VAE 作为 latent tokenizer。
3. **Phase 3** – 在 latent 上扩散或自回归生成：
   - 统一 DNA/RNA/蛋白/小分子；融合序列、密度、能量。

最终形成“几何显式 → 语义隐式”的双层生成体系。

---

### 七、当前领域的主流目标
1. 统一多模态：DNA / RNA / 蛋白 / 小分子 / 实验密度；
2. 高亲和力 binder；
3. 可控条件生成（口袋、序列、能量）；
4. 结构–功能可解释性；
5. 可扩展、高通量的生成框架。

---

### 八、结论

- Flow + SH 扩散：适合物理可控、高亲和生成；
- Latent 扩散 / 自回归：适合多模态统一与语义泛化；
- ChemFrame 表示让所有模态共享 backbone 框架；
- 未来方向：在 latent 上实现跨模态 next-scale generation，融合几何与语义，实现真正的“分子世界模型”。

